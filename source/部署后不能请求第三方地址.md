## 部署应用后，无法访问第三方地址问题



在公司系统开发过程中，遭遇到一个十分离奇的问题

### 背景：

系统为spring boot应用，主要功能为为公司整个软硬件的测试业务提供流程管理以及结果反馈和整理。

系统使用到一个接口，接口功能为根据用户工号查询用户的详细信息。接口提供方为公司内另一个部署的系统，

获取方式通过http请求服务。


### 具体表现：

开发过程中，使用java内置/postman调用接口都正常，功能正常无问题

但是将服务部署至Linux服务器上，调用功能随即出现问题，请求远程服务无响应


		    

### 问题排查：

**1**.首先判断，部署的服务器与提供查询服务的服务器，网络上不连通，具体测试具体分析

分别ping和curl 目标地址，发现返回ping: unknowhost XXXXXXXX,断定应该是<font color=red>DNS设置问题</font>

因为公司全部使用内网开发，搜索解决方法，按以下操作

解决方法如下：

```
vim /etc/resolv.conf
```

**添加内网DNS服务器**：

```
search XXXXXX.com

nameserver 10.72.XXX.XX

nameserver 10.72.XXX.XX

nameserver 10.98.XX.XX
```

具体意义差不多就是，搜索DNS服务器，定义几个地址什么的，然后ping/curl测试，服务可以正常访问

一切都很完美，但是，我以为问题已经解决，但是问题才刚开始。



**2**.问题修改完毕，我迫不及待重启服务，调用自己的接口，等待着正确的返回结果。然而**仍然是错误的返回**！

难道是其他的逻辑错误？随即查看日志，日志显示仍然为unknowhost！！立刻再尝试ping和直接请求，但是

**结果一切正常**。。。



**3**.问题定位为服务内调用失败，服务外调用正常。

  细心的推导，仔细观察我发现了两者存在的区别，服务外调用，使用的是root账号打开，而服务的部署根据公司规定不能使用root账号，需要使用用户账号，应该是账号对DNS的影响，经过运维同学指导，问题的根源可能是

用户账号对DNS配置文件没有可读权限，致使用root账号修改的DNS文件内容对用户账号相当于没改过。



命令：

```
chmod 777 /etc/resolv.conf
```

格式：

```
chmod 权限数字 文件名
```

r 读权限read  4

w 写权限write 2

x 操作权限execute  1



权限数字对应权限组说明：

总共分为4部分

【文件或文件夹】【owner权限】【group权限】【others权限】

【文件是-，文件夹是d】【r/w/x相加】【r/w/x相加】【r/w/x相加】

Linux档案的基本权限就有九个，分别是owner/group/others三种身份各有自己的read/write/execute权限。



权限使用二进制权限表示法，1表示有权限，0表示没有权限，所以

r 读权限read  4     =        100

w 写权限write 2     =        010

x 操作权限execute  1    =     001

全权限即为     7    =      111，777表示三个种类都是全权限

```
chmod 777 /etc/resolv.conf
```

之后，再次启动服务进行尝试，顺利访问，至此问题解决。运维同学也表示，可能100台机器里面，他才可能遇到一次这种问题。

这种简易的权限设置方式也可以学习加入到自己的代码应用中。
